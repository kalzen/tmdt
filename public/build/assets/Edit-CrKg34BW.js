import{K as ie,m as ae,r as j,j as e,L as te,$ as re}from"./app-DVolXm_H.js";import{_ as i}from"./translate-CmK6Bi0q.js";import{A as le}from"./app-layout-BGMCOdRm.js";import{B as O}from"./button-DbKjlMrn.js";import{I as x}from"./input-BqT_-I7N.js";import{L as n}from"./label-BbBB_dkE.js";import{T as M}from"./textarea-B0P-i12b.js";import{C as k,a as F,b as $,c as E,d as P}from"./card-BM4_Yqij.js";import{T as ne,a as de,b as T,c as I}from"./tabs-DHy3rOEv.js";import{S as z}from"./switch-4TpfPNi4.js";import{S as ce,a as oe,b as me,c as he,d as ue}from"./select-D0xov34E.js";import{I as ge}from"./image-uploader-DO1pPgw5.js";import{C as R}from"./checkbox-CH4-Vrfq.js";import{C as pe,R as xe,a as je}from"./combobox-C-dUHp_b.js";import{H as fe}from"./heading-small-CrP9WFqi.js";import{I as m}from"./input-error-B90JfMxQ.js";import{T as J}from"./trash-2-kN2Ote4L.js";import{C as _e}from"./chevron-down-B2stwFhm.js";import{C as ve}from"./chevron-right-C1IPqF67.js";import"./sonner-CEinsP_z.js";import"./index-_mtVRR73.js";import"./index-C7NGfonP.js";import"./index-CW0FACpT.js";import"./index-BG5QGlun.js";import"./app-logo-icon-CCGXo8xc.js";import"./list-CcDTc0Y3.js";import"./store-CV19H3N4.js";import"./breadcrumb-Co9X1bHK.js";import"./index-Bh82dGG3.js";import"./PencilIcon-3FGGf-Tn.js";import"./search-CYjSE0ST.js";import"./popover-DRUTqp0_.js";const Ne=({items:l,selectedIds:A,onSelect:v,primaryCatalogueId:f,setPrimaryCatalogue:N})=>{const[y,D]=j.useState({}),C=t=>{D(g=>({...g,[t]:!g[t]}))},r=(t,g=0)=>{const S=t.children&&t.children.length>0,o=y[t.id]||!1,h=A.includes(t.id.toString()),L=f===t.id.toString(),p=g===0?"":`pl-${g*6}`;return e.jsxs("div",{className:"catalogue-item",children:[e.jsxs("div",{className:`flex items-center py-1 ${p}`,children:[e.jsx("div",{className:"flex-shrink-0 w-6",children:S?e.jsx(O,{type:"button",variant:"ghost",size:"sm",className:"p-0 h-5 w-5",onClick:()=>C(t.id),children:o?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(ve,{className:"h-4 w-4"})}):null}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:`cat-${t.id}`,checked:h,onCheckedChange:b=>v(t.id.toString(),!!b)}),e.jsx(n,{htmlFor:`cat-${t.id}`,className:"cursor-pointer",children:t.name}),h&&e.jsxs("div",{className:"ml-2",children:[e.jsx("input",{type:"radio",id:`primary-${t.id}`,name:"primary_catalogue",className:"mr-1",checked:L,onChange:()=>N(t.id.toString())}),e.jsx("label",{htmlFor:`primary-${t.id}`,className:"text-xs text-muted-foreground cursor-pointer",children:"Primary"})]})]})]}),S&&o&&e.jsx("div",{className:"catalogue-children ml-2",children:t.children.map(b=>r(b,g+1))})]},t.id)};return e.jsx("div",{className:"catalogue-tree",children:l.map(t=>r(t))})};function ss({product:l,catalogues:A,catalogueTree:v,stores:f,attributes:N,productAttributes:y}){const{auth:D}=ie().props,C=D.user&&D.user.is_admin,{data:r,setData:t,post:g,processing:S,errors:o}=ae({title:l.title||"",sku:l.sku||"",description:l.description||"",content:l.content||"",price:l.price.toString()||"",sale_price:l.sale_price?l.sale_price.toString():"",stock_quantity:l.stock_quantity.toString()||"0",catalogue_id:l.catalogue_id?l.catalogue_id.toString():"",catalogue_ids:l.catalogues?l.catalogues.map(s=>s.id.toString()):[],store_id:l.store_id?l.store_id.toString():"",is_active:l.is_active,is_featured:l.is_featured,meta_title:l.meta_title||"",meta_description:l.meta_description||"",thumbnail:null,gallery:[],attributes:{},_method:"PUT"}),[h,L]=j.useState([]),[p,b]=j.useState(l.gallery||[]),[U,Q]=j.useState(l.content||""),[G,V]=j.useState("tree"),[ye,W]=j.useState({});j.useEffect(()=>{if(y){let s={};Object.entries(y).forEach(([a,d])=>{const c=N.find(_=>_.id===parseInt(a));c&&(c.type==="multiselect"?s[parseInt(a)]=d.split(","):s[parseInt(a)]=d)}),t("attributes",s)}},[y]),j.useEffect(()=>{if(v&&r.catalogue_ids.length>0){const s={},a=d=>{d.forEach(c=>{r.catalogue_ids.includes(c.id.toString())&&(s[c.id]=!0),c.children&&c.children.length>0&&(c.children.some(u=>r.catalogue_ids.includes(u.id.toString())||u.children&&u.children.some(q=>r.catalogue_ids.includes(q.id.toString())))&&(s[c.id]=!0),a(c.children))})};a(v),W(s)}},[]);const X=[{title:i("admin.products","Products"),href:route("products.index")},{title:l.title,href:route("products.edit",l.id)}],Y=s=>{s.preventDefault(),U&&t("content",U),g(route("products.update",l.id),{forceFormData:!0})},Z=s=>{L([...h,...s]),t("gallery",[...h,...s])},w=(s,a)=>{t("attributes",{...r.attributes,[s]:a})},ee=async s=>{var a;if(confirm("Are you sure you want to delete this image?"))try{const c=await(await fetch(route("products.delete-media",l.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""},body:JSON.stringify({media_id:s})})).json();c.success?b(p.filter(_=>_.id!==s)):alert("Failed to delete image: "+(c.message||"Unknown error"))}catch(d){console.error("Error deleting image:",d),alert("Failed to delete image")}},se=s=>{const a=[...h];a.splice(s,1),L(a),t("gallery",a)},B=(s,a)=>{let d=[...r.catalogue_ids];a?(d.push(s),r.catalogue_id===""&&t("catalogue_id",s)):(d=d.filter(c=>c!==s),r.catalogue_id===s&&d.length>0?t("catalogue_id",d[0]):d.length===0&&t("catalogue_id","")),t("catalogue_ids",d)},H=s=>{t("catalogue_id",s)},K=f.map(s=>({value:s.id.toString(),label:s.name}));return C&&f.length>1&&K.unshift({value:"",label:i("admin.none","None")}),e.jsxs(le,{breadcrumbs:X,children:[e.jsx(te,{title:`${i("admin.edit_product","Edit Product")}: ${l.title}`}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(fe,{title:`${i("admin.edit_product","Edit Product")}: ${l.title}`,description:i("admin.edit_product_description","Update product information")})}),e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsxs(ne,{defaultValue:"general",className:"w-full",children:[e.jsxs(de,{className:"mb-4",children:[e.jsx(T,{value:"general",children:i("admin.general","General")}),e.jsx(T,{value:"data",children:i("admin.data","Data")}),e.jsx(T,{value:"media",children:i("admin.media","Media")}),e.jsx(T,{value:"attributes",children:i("admin.attributes","Attributes")}),e.jsx(T,{value:"seo",children:i("admin.seo","SEO")})]}),e.jsx(I,{value:"general",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx($,{children:i("admin.general_information","General Information")}),e.jsx(E,{children:i("admin.general_information_description","Basic product information")})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"title",children:[i("admin.product_title","Product Title")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(x,{id:"title",value:r.title,onChange:s=>t("title",s.target.value),placeholder:i("admin.product_title_placeholder","Enter product title")}),e.jsx(m,{message:o.title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"slug",children:i("admin.slug","Slug")}),e.jsx(x,{id:"slug",value:l.slug,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.slug_auto_generated","Slug is auto-generated and cannot be changed")})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"sku",children:i("admin.sku","SKU")}),e.jsx(x,{id:"sku",value:r.sku,onChange:s=>t("sku",s.target.value),placeholder:i("admin.sku_placeholder","Product Stock Keeping Unit")}),e.jsx(m,{message:o.sku})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"description",children:i("admin.short_description","Short Description")}),e.jsx(M,{id:"description",value:r.description,onChange:s=>t("description",s.target.value),placeholder:i("admin.short_description_placeholder","Brief description for product listings"),rows:3}),e.jsx(m,{message:o.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"content",children:i("admin.full_description","Full Description")}),e.jsx(M,{id:"content",value:r.content,onChange:s=>{t("content",s.target.value),Q(s.target.value)},placeholder:i("admin.full_description_placeholder","Detailed product description"),rows:6}),e.jsx(m,{message:o.content})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{htmlFor:"catalogue_id",children:[i("admin.catalogue","Catalogue")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("button",{type:"button",className:`px-2 py-1 rounded ${G==="tree"?"bg-primary text-white":"bg-muted"}`,onClick:()=>V("tree"),children:"Tree View"}),e.jsx("button",{type:"button",className:`px-2 py-1 rounded ${G==="flat"?"bg-primary text-white":"bg-muted"}`,onClick:()=>V("flat"),children:"Flat View"})]})]}),e.jsx("div",{className:"border rounded-md p-4 max-h-[300px] overflow-y-auto",children:G==="tree"?e.jsx(Ne,{items:v,selectedIds:r.catalogue_ids,onSelect:B,primaryCatalogueId:r.catalogue_id,setPrimaryCatalogue:H}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:A.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:`catalogue-${s.id}`,checked:r.catalogue_ids.includes(s.id.toString()),onCheckedChange:a=>{B(s.id.toString(),!!a)}}),e.jsx(n,{htmlFor:`catalogue-${s.id}`,children:s.name}),r.catalogue_ids.includes(s.id.toString())&&e.jsxs("div",{className:"ml-2",children:[e.jsx("input",{type:"radio",id:`primary-${s.id}`,name:"primary_catalogue",className:"mr-1",checked:r.catalogue_id===s.id.toString(),onChange:()=>H(s.id.toString())}),e.jsx("label",{htmlFor:`primary-${s.id}`,className:"text-xs text-muted-foreground",children:"Primary"})]})]},s.id))})}),e.jsx("div",{className:"text-sm text-muted-foreground",children:i("admin.select_multiple_catalogues","Select one or more catalogues for this product")}),e.jsx(m,{message:o.catalogue_ids||o.catalogue_id})]}),f.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"store_id",children:i("admin.store","Store")}),e.jsx(pe,{options:K,value:r.store_id,onChange:s=>t("store_id",s),placeholder:i("admin.select_store","Select store"),emptyMessage:i("admin.no_stores_found","No stores found"),className:"w-full",disabled:!C||f.length===1}),!C&&f.length===1&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.store_fixed","Products can only be assigned to your store")}),e.jsx(m,{message:o.store_id})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"is_active",checked:r.is_active,onCheckedChange:s=>t("is_active",s)}),e.jsx(n,{htmlFor:"is_active",children:i("admin.is_active","Active")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"is_featured",checked:r.is_featured,onCheckedChange:s=>t("is_featured",s)}),e.jsx(n,{htmlFor:"is_featured",children:i("admin.is_featured","Featured Product")})]})]})]})}),e.jsx(I,{value:"data",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx($,{children:i("admin.product_data","Product Data")}),e.jsx(E,{children:i("admin.product_data_description","Price and inventory information")})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"price",children:[i("admin.price","Price")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(x,{id:"price",type:"number",min:"0",step:"0.01",value:r.price,onChange:s=>t("price",s.target.value),placeholder:"0.00"}),e.jsx(m,{message:o.price})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"sale_price",children:i("admin.sale_price","Sale Price")}),e.jsx(x,{id:"sale_price",type:"number",min:"0",step:"0.01",value:r.sale_price,onChange:s=>t("sale_price",s.target.value),placeholder:"0.00"}),e.jsx(m,{message:o.sale_price})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(n,{htmlFor:"stock_quantity",children:[i("admin.stock_quantity","Stock Quantity")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(x,{id:"stock_quantity",type:"number",min:"0",step:"1",value:r.stock_quantity,onChange:s=>t("stock_quantity",s.target.value),placeholder:"0"}),e.jsx(m,{message:o.stock_quantity})]})]})]})}),e.jsx(I,{value:"media",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx($,{children:i("admin.product_media","Product Media")}),e.jsx(E,{children:i("admin.product_media_description","Product images and gallery")})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(n,{children:i("admin.thumbnail","Thumbnail Image")}),e.jsx(ge,{id:"thumbnail",onChange:s=>t("thumbnail",s),value:l.thumbnail,title:i("admin.thumbnail_image","Thumbnail Image"),description:i("admin.thumbnail_description","Main product image"),error:o.thumbnail,helpText:i("admin.image_help_text","Recommended size: 800x800px, Max 2MB"),placeholder:"/assets/placeholders/product.png",className:"w-full h-60",previewClassName:"w-full h-60 object-contain"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx(n,{children:i("admin.gallery","Product Gallery")}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[p.length+h.length," / 8 ",i("admin.images","images")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.map(s=>e.jsxs("div",{className:"relative border rounded-md overflow-hidden",children:[e.jsx("img",{src:s.url,alt:s.name,className:"w-full h-32 object-cover"}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 bg-destructive text-white p-1 rounded-full",onClick:()=>ee(s.id),children:e.jsx(J,{className:"h-4 w-4"})})]},s.id)),h.map((s,a)=>e.jsxs("div",{className:"relative border rounded-md overflow-hidden",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`New gallery image ${a+1}`,className:"w-full h-32 object-cover"}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 bg-destructive text-white p-1 rounded-full",onClick:()=>se(a),children:e.jsx(J,{className:"h-4 w-4"})})]},`new-${a}`)),p.length+h.length<8&&e.jsxs("div",{className:"border-2 border-dashed rounded-md p-6 flex flex-col items-center justify-center cursor-pointer hover:border-primary/50",children:[e.jsx("input",{type:"file",id:"gallery",multiple:!0,className:"hidden",accept:"image/*",onChange:s=>{if(s.target.files){const a=Array.from(s.target.files),d=8-(p.length+h.length),c=a.slice(0,d);Z(c)}}}),e.jsx(n,{htmlFor:"gallery",className:"cursor-pointer text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx("svg",{className:"w-6 h-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("span",{className:"text-sm font-medium",children:i("admin.add_images","Add Images")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i("admin.up_to_n_images","Up to {count} images, max 2MB each").replace("{count}",(8-(p.length+h.length)).toString())})]})})]})]}),e.jsx(m,{message:o.gallery})]})]})]})}),e.jsx(I,{value:"attributes",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx($,{children:i("admin.product_attributes","Product Attributes")}),e.jsx(E,{children:i("admin.product_attributes_description","Define product specifications and features")})]}),e.jsx(P,{children:e.jsx("div",{className:"space-y-6",children:N.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:i("admin.no_attributes_defined","No attributes have been defined yet.")}):N.map(s=>e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsxs("h3",{className:"font-medium mb-2",children:[s.name,s.is_required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.type==="text"&&e.jsx(x,{placeholder:`Enter ${s.name.toLowerCase()}`,value:r.attributes[s.id]||"",onChange:a=>w(s.id,a.target.value)}),s.type==="textarea"&&e.jsx(M,{placeholder:`Enter ${s.name.toLowerCase()}`,value:r.attributes[s.id]||"",onChange:a=>w(s.id,a.target.value),rows:3}),s.type==="select"&&e.jsxs(ce,{value:r.attributes[s.id]||"",onValueChange:a=>w(s.id,a),children:[e.jsx(oe,{children:e.jsx(me,{placeholder:`Select ${s.name.toLowerCase()}`})}),e.jsx(he,{children:s.values.map(a=>e.jsx(ue,{value:a.id.toString(),children:a.value},a.id))})]}),s.type==="multiselect"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.values.map(a=>{const d=r.attributes[s.id]||[],c=d.includes(a.id.toString());return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:`attr-${s.id}-${a.id}`,checked:c,onCheckedChange:_=>{let u=[...d];_?u.includes(a.id.toString())||u.push(a.id.toString()):u=u.filter(q=>q!==a.id.toString()),w(s.id,u)}}),e.jsx(n,{htmlFor:`attr-${s.id}-${a.id}`,children:a.value})]},a.id)})}),s.type==="radio"&&e.jsx(xe,{value:r.attributes[s.id]||"",onValueChange:a=>w(s.id,a),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.values.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{value:a.id.toString(),id:`attr-${s.id}-${a.id}`}),e.jsx(n,{htmlFor:`attr-${s.id}-${a.id}`,children:a.value})]},a.id))})})]},s.id))})})]})}),e.jsx(I,{value:"seo",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx($,{children:i("admin.seo_information","SEO Information")}),e.jsx(E,{children:i("admin.seo_information_description","Search engine optimization details")})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"meta_title",children:i("admin.meta_title","Meta Title")}),e.jsx(x,{id:"meta_title",value:r.meta_title,onChange:s=>t("meta_title",s.target.value),placeholder:i("admin.meta_title_placeholder","SEO meta title")}),e.jsx(m,{message:o.meta_title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"meta_description",children:i("admin.meta_description","Meta Description")}),e.jsx(M,{id:"meta_description",value:r.meta_description,onChange:s=>t("meta_description",s.target.value),placeholder:i("admin.meta_description_placeholder","SEO meta description"),rows:3}),e.jsx(m,{message:o.meta_description})]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{type:"submit",disabled:S,children:S?i("admin.saving","Saving..."):i("admin.save_product","Save Product")}),e.jsx(re,{href:route("products.index"),children:e.jsx(O,{variant:"outline",type:"button",children:i("admin.cancel","Cancel")})})]})]})]})]})}export{ss as default};
