import{m as M,r as g,j as e,L as T,$ as L}from"./app-BtGE91pR.js";import{A as B,D as H,a as I,b as $,g as K,h as P,i as z}from"./app-layout-CTGCn8wo.js";import{H as A}from"./heading-small-DTpMhSUQ.js";import{B as x}from"./button-DKLb_cAM.js";import{I as f}from"./input-CiV0XKd-.js";import{L as d}from"./label-D-2WubvP.js";import{I as m}from"./input-error-BD6ojJeN.js";import{C as U}from"./checkbox-Cm9MGvrF.js";import{I as R}from"./image-uploader-TmWLqa2Q.js";import{B as V}from"./badge-D3bSlaj0.js";import{E as X}from"./editor-c36gxAQv.js";import{T as C}from"./tag-Dfr2qyGX.js";import{C as q}from"./chevron-down-kKVuXPxj.js";import{z as G}from"./transition-qy0DLUrs.js";import"./sonner-ADRQgd_T.js";import"./index-DQkJsBT1.js";import"./index-DJJ0opRn.js";import"./index-DG753qKl.js";import"./index-DcQdqpwx.js";import"./index-Bw90D0kP.js";import"./app-logo-icon-E3-GpmeE.js";import"./list-CQBPjU6S.js";import"./store-oIZzt7RG.js";import"./breadcrumb-VnWDUXDp.js";import"./chevron-right-eQMH9edB.js";import"./index-B94CT-Ga.js";import"./card-CYxKPOTH.js";import"./PencilIcon-DHqNbmOM.js";import"./index-BVChDBjk.js";import"./image-BELCcjxE.js";function ye({post:t,categories:l=[]}){const w=[{title:"Bài viết",href:route("posts.index")},{title:t.title,href:route("posts.edit",t.id)}],{data:s,setData:a,post:y,processing:b,errors:r,recentlySuccessful:_,clearErrors:D}=M({title:t.title,content:t.content,description:t.description,slug:t.slug,image:null,is_published:t.is_published,published_at:t.published_at||"",categories:t.categories||[],_method:"PUT"}),S=i=>{i.preventDefault(),s.slug===t.slug&&D("slug"),y(route("posts.update",t.id),{forceFormData:!0})},F=i=>{i.key==="Enter"&&(i.ctrlKey||i.metaKey)&&(i.preventDefault(),i.stopPropagation())},k=()=>{s.title&&s.title!==t.title&&s.slug===t.slug&&a("slug",s.title.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""))};g.useEffect(()=>{k()},[s.title]),t.categories.map(i=>i.toString()),l.map(i=>({label:i.name,value:i.id.toString(),icon:C}));const[u,j]=g.useState([]);g.useEffect(()=>{const i=t.categories.map(n=>{const c=l.find(h=>h.id===n);return c?c.name:""}).filter(n=>n!=="");j(i)},[t.categories,l]);const E=(i,n)=>{var v,N;let c,h;if(n){c=[...s.categories,i];const p=((v=l.find(o=>o.id===i))==null?void 0:v.name)||"";h=[...u,p]}else{c=s.categories.filter(o=>o!==i);const p=((N=l.find(o=>o.id===i))==null?void 0:N.name)||"";h=u.filter(o=>o!==p)}a("categories",c),j(h)};return e.jsxs(B,{breadcrumbs:w,children:[e.jsx(T,{title:`Sửa bài viết: ${t.title}`}),e.jsxs("div",{className:"space-6 px-4 py-6",children:[e.jsx("div",{className:"pb-4",children:e.jsx(A,{title:`Sửa bài viết: ${t.title}`,description:"Chỉnh sửa nội dung và thông tin bài viết"})}),e.jsxs("form",{onSubmit:S,className:"space-y-6 pt-4 border-t",onKeyDown:F,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"title",children:"Tiêu đề"}),e.jsx(f,{id:"title",value:s.title,onChange:i=>a("title",i.target.value),placeholder:"Tiêu đề bài viết"}),e.jsx(m,{message:r.title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"slug",children:"Đường dẫn"}),e.jsx(f,{id:"slug",value:s.slug,onChange:i=>a("slug",i.target.value),placeholder:"duong-dan-bai-viet"}),e.jsx(m,{message:r.slug})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"description",children:"Mô tả"}),e.jsx("textarea",{id:"description",className:"min-h-[120px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:s.description,onChange:i=>a("description",i.target.value),placeholder:"Mô tả ngắn gọn về bài viết của bạn",rows:3}),e.jsx(m,{message:r.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"content",children:"Nội dung"}),e.jsx(X,{value:s.content,onChange:i=>a("content",i),placeholder:"Viết nội dung bài viết của bạn tại đây..."}),e.jsx(m,{message:r.content})]}),l.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"categories",children:"Danh mục"}),e.jsxs(H,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between",children:[e.jsx("span",{className:"flex flex-wrap gap-1",children:u.length>0?u.map((i,n)=>e.jsx(V,{variant:"secondary",className:"mr-1",children:i},n)):e.jsx("span",{className:"text-muted-foreground",children:"Chọn danh mục cho bài viết"})}),e.jsx(q,{className:"h-4 w-4 opacity-50"})]})}),e.jsxs($,{align:"start",className:"w-56 max-h-80 overflow-auto",children:[e.jsx(K,{children:"Danh mục"}),e.jsx(P,{}),l.map(i=>e.jsx(z,{checked:s.categories.includes(i.id),onCheckedChange:n=>E(i.id,n),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2 text-muted-foreground"}),i.name]})},i.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Bạn có thể chọn nhiều danh mục cho bài viết"}),r.categories&&e.jsx("p",{className:"text-sm text-red-600",children:r.categories})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx(R,{id:"image",value:t.featured_image,onChange:i=>a("image",i),title:"Hình ảnh đại diện",description:"Cập nhật hình ảnh đại diện",error:r.image,helpText:"Để trống nếu không muốn thay đổi hình ảnh. Hệ thống sẽ tự động tối ưu hình ảnh mới.",placeholder:"/assets/image-placeholder.png",className:"w-24 h-24 rounded-md",previewClassName:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"is_published",checked:s.is_published,onCheckedChange:i=>a("is_published",i)}),e.jsx(d,{htmlFor:"is_published",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Xuất bản ngay"}),e.jsx(m,{message:r.is_published})]}),!s.is_published&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"published_at",children:"Ngày xuất bản"}),e.jsx(f,{id:"published_at",type:"datetime-local",value:s.published_at,onChange:i=>a("published_at",i.target.value)}),e.jsx(m,{message:r.published_at})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{type:"submit",disabled:b,children:b?"Đang cập nhật...":"Cập nhật bài viết"}),e.jsx(L,{href:route("posts.index"),children:e.jsx(x,{variant:"outline",type:"button",children:"Hủy"})}),e.jsx(G,{show:_,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600",children:"Đã lưu"})})]})]})]})]})}export{ye as default};
